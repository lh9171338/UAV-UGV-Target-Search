#pragma once
#ifndef JMD_CHROMATAG_POSE_H_
#define JMD_CHROMATAG_POSE_H_

/*
 //====================================================================//
 
 ==========================
 Joseph DeGol
 UIUC Fall 2015
 ==========================
 JMD ChromaTag Pose: Version 1.0
 ==========================
 
 ================================================================
 JMD_ChromaTag_Pose.hpp
 A class for ChromaTag Pose Estimation
 ================================================================
 
 List of Functions:
 
 ----- Enumerations -----
 
 --- End Enumerations ---
 
 ----- Constructors -----
 
 --- end Constructors ---
 
 ----- Utility Methods -----
 
 --- End Utility Methods ---
 
 Notes:
 //====================================================================//
 */





//====================================================================//
//====================================================================//
//============================ Preamble ==============================//
//====================================================================//
//====================================================================//


//---------------------------------------------------------------//
//------------------------- Includes ----------------------------//
//---------------------------------------------------------------//


//system
#include <cstring>

//ChromaTag
#include "JMD_ChromaTag_Common.hpp"

//---------------------------------------------------------------//
//------------------------ end Includes -------------------------//
//---------------------------------------------------------------//


//---------------------------------------------------------------//
//----------------------- Namespaces ----------------------------//
//---------------------------------------------------------------//

//---------------------------------------------------------------//
//---------------------- end Namespaces -------------------------//
//---------------------------------------------------------------//


//---------------------------------------------------------------//
//------------------------- Globals -----------------------------//
//---------------------------------------------------------------//

//---------------------------------------------------------------//
//------------------------ end Globals --------------------------//
//---------------------------------------------------------------//


//---------------------------------------------------------------//
//------------------- Function Prototypes -----------------------//
//---------------------------------------------------------------//

//---------------------------------------------------------------//
//------------------ end Function Prototypes --------------------//
//---------------------------------------------------------------//

//====================================================================//
//====================================================================//
//====================================================================//
//====================================================================//
//====================================================================//







namespace JMD {
	
	//====================================================================//
    //====================================================================//
    //================== JMD ChromaTag Pose Definition ===================//
    //====================================================================//
    //====================================================================//
    class JMD_ChromaTag_Pose
    {
        
        /*--------------- Enumerations ---------------*/
        public:
        /*------------- End Enumerations -------------*/
        
        /*--------------- Variables ---------------*/
        /*------------- End Variables -------------*/
        
        //---------------------------------------------------------------//
        //------------------------- Private -----------------------------//
        //---------------------------------------------------------------//
        private:
        
        /*--------------- Variables ---------------*/
		
        //ChromaTag
        JMD_ChromaTag_Collection *myDetections;
        JMD_ChromaTag_Settings   *mySettings;
		
        //Pose
        std::vector<cv::Point3f>  myWorldPoints;
        unsigned int              myNumRingsToUse;
        double                   *myK;
        double                   *myDistCoefs;
        
        /*------------- End Variables -------------*/
        
        
        /*--------------- Setup Methods ---------------*/
        
        /*----- Private Init -----*/
        // does all the initialization of private instance variables
        //
        // input:
        //    settings_param - JMD_ChromaTag_Settings object
        void Private_Init(JMD_ChromaTag_Settings *settings_param = nullptr);
        /*--- End Private Init ---*/
        
        /*------------- End General Heleprs -------------*/
        
        
        /*--------------- Pose Methods ---------------*/
        
        /*----- Private Pose -----*/
        // entry point for solving for pose given the tag detections
        //
        void Private_Pose();
        /*--- End Private Pose ---*/

        /*----- Private PNP -----*/
        // calculates the pose of the camera using the PnP method
        //
        // input:
        //    image_points_param - points in the image
        //    rvec_param - returned rotation vector
        //    tvec_param - returned translation vector
        bool Private_PnP(std::vector<cv::Point2f> &image_points_pararm, cv::Mat &rvec_param, cv::Mat &tvec_param );
        /*--- End Private PNP ---*/
        
        /*------------- End Pose Methods -------------*/
        
        //---------------------------------------------------------------//
        //----------------------- end Private ---------------------------//
        //---------------------------------------------------------------//
        
        
        //---------------------------------------------------------------//
        //-------------------------- Public -----------------------------//
        //---------------------------------------------------------------//
        public:
        
		/*--------------- Constructors ---------------*/
        // Constructors
        //
        // input:
        //    collection_param - pointer to vector of detections to pose
        JMD_ChromaTag_Pose(JMD_ChromaTag_Collection *collection_param);
		/*------------- end Constructors -------------*/
		
        
		
		/*--------------- Destructors ---------------*/
		~JMD_ChromaTag_Pose();
		/*-------------- End Destructors ------------*/
        
        
        
        /*--------------- Setup ---------------*/

        /*----- Init -----*/
        // allows the user to specify parameters for ChromaTag
        //
        // input:
        //    settings_param - JMD_Settings_ChromaTag struct with settings
        void Init(JMD_ChromaTag_Settings *settings_param);
        /*--- End Init ---*/
        
        /*------------- End Setup -------------*/



        /*--------------- Tag Pose Estimation Methods ---------------*/
        
        /*----- Pose -----*/
        // calculates the pose of detected tags
        //
        // input:
        //    
        void Pose( );
        /*--- End Pose ---*/
        
        /*------------- End Tag Pose Estimation Methods -------------*/
        
		
		
        /*--------------- Utility Methods ---------------*/
        /*------------- End Utility Methods -------------*/
        
        
        
        /*--------------- Setters/Getters ---------------*/
        /*------------- End Setters/Getters -------------*/
        
        
        
        /*--------------- Operator Overloads ---------------*/
        /*------------- End Operator Overloads -------------*/
        
        
        
        /*--------------- DEBUG Methods ---------------*/
        /*------------- End DEBUG Methods -------------*/
        
        //---------------------------------------------------------------//
        //------------------------ end Public ---------------------------//
        //---------------------------------------------------------------//
        
        
    };
    //====================================================================//
    //====================================================================//
    //====================================================================//
    //====================================================================//
    //====================================================================//
    
}//end namespace JMD


#endif